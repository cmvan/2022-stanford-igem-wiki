image: node:18.6.0

build:
 stage: build
 cache:
   paths:
     - node_modules/
 script:
   - npm install
   - npm run build
 artifacts:
   paths:
     - build

test:
 stage: test
 cache:
   paths:
     - node_modules/
   policy: pull
 script:
   - npm run test

pages:
 stage: deploy
 cache:
   paths:
     - node_modules/
 script:
   - npm install
   - npm run build
   - rm -rf public
   - cp build/index.html build/404.html
   - mv build public
 artifacts:
   paths:
     - public
 only:
   - master